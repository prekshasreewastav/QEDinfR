<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Greedy Matching Methods • QEDinfR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Greedy Matching Methods">
<meta property="og:description" content="QEDinfR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">QEDinfR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Matching.html">Greedy Matching Methods</a>
    </li>
    <li>
      <a href="../articles/did.html">Differences in Differences</a>
    </li>
    <li>
      <a href="../articles/rdd.html">Regression Discontinuity Design</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Matching_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Greedy Matching Methods</h1>
            
      
      
      <div class="hidden name"><code>Matching.Rmd</code></div>

    </div>

    
    
<div id="basic-example-code" class="section level1">
<h1 class="hasAnchor">
<a href="#basic-example-code" class="anchor"></a>Basic Example Code</h1>
<p>QEDinfR provides functions which make basic Greedy Matching methods and eventual Outcome analysis easy and quick. Using the qed_match, we first perform Greedy matching (with or without a specified caliper and with or without replacement while matching) using either Propensity Scores (calculated through a fitted logistic regression) or Mahalanobis Distances (the square root of the sum of the squared distances of each covariate scaled by the covariance matrix).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">QEDinfR</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">)</span></code></pre></div>
<div id="propensity-score-matching-categorical-outcome" class="section level2">
<h2 class="hasAnchor">
<a href="#propensity-score-matching-categorical-outcome" class="anchor"></a>Propensity Score Matching (categorical outcome)</h2>
<p>First, we demonstrate how to perform Greedy Matching using Propensity Scores with a categorical outcome of interest. This method entails fitting a logistic regression model (with treatment as the outcome) to obtain fitted values for all observations. These fitted values essentially denote the probability of an observation belonging in the treatment group vs. the control group. We do not use a caliper in this case, and perform the matching without replacement.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lalonde</span><span class="op">$</span><span class="va">nodegr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">nodegr</span><span class="op">)</span>
<span class="va">ps_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qed_match.html">qed_match</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">black</span>, <span class="st">"nodegr"</span>, <span class="va">lalonde</span>, <span class="st">"propensityscore"</span>, caliper <span class="op">=</span> <span class="cn">NULL</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ps_match</span><span class="op">)</span>
<span class="co">#&gt; ---------------------------------------------</span>
<span class="co">#&gt;        Matching Summary Statistics</span>
<span class="co">#&gt; ---------------------------------------------</span>
<span class="co">#&gt; Method: Greedy Matching</span>
<span class="co">#&gt; Distance Measure: Propensity Score</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Variables used for Matching: </span>
<span class="co">#&gt;  age educ black </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; % Missing Values: </span>
<span class="co">#&gt;   age  educ black </span>
<span class="co">#&gt;     0     0     0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Summary:</span>
<span class="co">#&gt; Estimate...  -0.075676 </span>
<span class="co">#&gt; SE.........  0.033731 </span>
<span class="co">#&gt; T-stat.....  -2.2435 </span>
<span class="co">#&gt; p.val......  0.024864 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Original number of observations..............  445 </span>
<span class="co">#&gt; Original number of treated obs...............  185 </span>
<span class="co">#&gt; Matched number of observations...............  185 </span>
<span class="co">#&gt; Matched number of observations  (unweighted).  185 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Standardized Mean Differences:</span>
<span class="co">#&gt;   Pre-Matched - </span>
<span class="co">#&gt;                    Stratified by treat</span>
<span class="co">#&gt;                     0            1            SMD   </span>
<span class="co">#&gt;   n                   260          185              </span>
<span class="co">#&gt;   age (mean (SD))   25.05 (7.06) 25.82 (7.16)  0.107</span>
<span class="co">#&gt;   educ (mean (SD))  10.09 (1.61) 10.35 (2.01)  0.141</span>
<span class="co">#&gt;   black (mean (SD))  0.83 (0.38)  0.84 (0.36)  0.044</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Post-Matched - </span>
<span class="co">#&gt;                    Stratified by treat</span>
<span class="co">#&gt;                     0            1            SMD   </span>
<span class="co">#&gt;   n                   185          185              </span>
<span class="co">#&gt;   age (mean (SD))   25.63 (7.11) 25.82 (7.16)  0.027</span>
<span class="co">#&gt;   educ (mean (SD))  10.35 (1.51) 10.35 (2.01) &lt;0.001</span>
<span class="co">#&gt;   black (mean (SD))  0.82 (0.39)  0.84 (0.36)  0.072</span></code></pre></div>
<p>From the above summary statistics, we see that Greedy Matching using Propensity Scores has reduced the Standardized Mean Differences (SMD) between the control group and treatment group on most included covariates, with the exception of ‘black’. However, following the general rule of thumb that SMD values &lt; 0.1 are desirable, this data is now ready to perform outcome analysis on.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">QEDinfR</span><span class="fu">::</span><span class="fu"><a href="../reference/test.html">test</a></span><span class="op">(</span><span class="va">ps_match</span><span class="op">)</span>
<span class="co">#&gt; ---------------------------------------</span>
<span class="co">#&gt;     Categorical Outcome: nodegr</span>
<span class="co">#&gt; ---------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Exact McNemar test (with central confidence intervals)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  table(con, trt)</span>
<span class="co">#&gt; b = 13, c = 27, p-value = 0.03848</span>
<span class="co">#&gt; alternative hypothesis: true odds ratio is not equal to 1</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  0.2280923 0.9657754</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; odds ratio </span>
<span class="co">#&gt;  0.4814815 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; --------------------------------------- </span>
<span class="co">#&gt; The association is statistically significant at the 0.05 level. (p-value = 0.03847731)</span>
<span class="co">#&gt; Observations in the treated group are 0.4814815 as likely to be a positive case* </span>
<span class="co">#&gt; *(i.e. belong to outcome (nodegr) level = 1).</span></code></pre></div>
<p>Given that the variable of interest was categorical (whether or not a person had attained a highschool diploma), we perform a Mcnemar test to check for odds ratios between the control group and treatment group with respect to the outcome variable, ‘nodegr’.</p>
<p>From the results, we see that the association is significant at the 0.05 level, and people in the treated group are 0.4167 times as likely to not obtain a highscool degree.</p>
</div>
<div id="mahalanobis-distance-matching-numeric-outcome" class="section level2">
<h2 class="hasAnchor">
<a href="#mahalanobis-distance-matching-numeric-outcome" class="anchor"></a>Mahalanobis Distance Matching (numeric outcome)</h2>
<p>Next, we demonstrate how to perform Greedy Matching with Mahalanobis distances, using a caliper of 0.1 and without replacement, with a numeric outcome of interest. The Mahalanobis distances are obtained by computing square root of the sum of the squared distances of each covariate scaled by the covariance matrix</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">md_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qed_match.html">qed_match</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">black</span>, <span class="st">"re78"</span>, <span class="va">lalonde</span>, <span class="st">"mahalanobis"</span>, caliper <span class="op">=</span> <span class="fl">0.1</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">md_match</span><span class="op">)</span>
<span class="co">#&gt; ---------------------------------------------</span>
<span class="co">#&gt;        Matching Summary Statistics</span>
<span class="co">#&gt; ---------------------------------------------</span>
<span class="co">#&gt; Method: Greedy Matching</span>
<span class="co">#&gt; Distance Measure: Mahalanobis</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Variables used for Matching: </span>
<span class="co">#&gt;  age educ black </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; % Missing Values: </span>
<span class="co">#&gt;   age  educ black </span>
<span class="co">#&gt;     0     0     0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Summary:</span>
<span class="co">#&gt; Estimate...  1664.7 </span>
<span class="co">#&gt; SE.........  891.95 </span>
<span class="co">#&gt; T-stat.....  1.8663 </span>
<span class="co">#&gt; p.val......  0.061997 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Original number of observations..............  445 </span>
<span class="co">#&gt; Original number of treated obs...............  185 </span>
<span class="co">#&gt; Matched number of observations...............  107 </span>
<span class="co">#&gt; Matched number of observations  (unweighted).  107 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Caliper (SDs)........................................   0.1 0.1 0.1 </span>
<span class="co">#&gt; Number of obs dropped by 'exact' or 'caliper'  78 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Standardized Mean Differences:</span>
<span class="co">#&gt;   Pre-Matched - </span>
<span class="co">#&gt;                    Stratified by treat</span>
<span class="co">#&gt;                     0            1            SMD   </span>
<span class="co">#&gt;   n                   260          185              </span>
<span class="co">#&gt;   age (mean (SD))   25.05 (7.06) 25.82 (7.16)  0.107</span>
<span class="co">#&gt;   educ (mean (SD))  10.09 (1.61) 10.35 (2.01)  0.141</span>
<span class="co">#&gt;   black (mean (SD))  0.83 (0.38)  0.84 (0.36)  0.044</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Post-Matched - </span>
<span class="co">#&gt;                    Stratified by treat</span>
<span class="co">#&gt;                     0            1            SMD   </span>
<span class="co">#&gt;   n                   107          107              </span>
<span class="co">#&gt;   age (mean (SD))   23.45 (4.98) 23.45 (4.98) &lt;0.001</span>
<span class="co">#&gt;   educ (mean (SD))  10.44 (1.25) 10.44 (1.25) &lt;0.001</span>
<span class="co">#&gt;   black (mean (SD))  0.91 (0.29)  0.91 (0.29) &lt;0.001</span></code></pre></div>
<p>From the above summary statistics, we see that Greedy Matching using Propensity Scores has reduced the Standardized Mean Differences (SMD) between the control group and treatment group on all included covariates. Following the general rule of thumb that SMD values &lt; 0.1 are desirable, this data is now ready to perform outcome analysis on.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">QEDinfR</span><span class="fu">::</span><span class="fu"><a href="../reference/test.html">test</a></span><span class="op">(</span><span class="va">md_match</span><span class="op">)</span>
<span class="co">#&gt; ---------------------------------------</span>
<span class="co">#&gt;     Numeric Outcome: re78</span>
<span class="co">#&gt; ---------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Paired t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  con and trt</span>
<span class="co">#&gt; t = -1.8576, df = 106, p-value = 0.066</span>
<span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  -3441.380   112.038</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean of the differences </span>
<span class="co">#&gt;               -1664.671 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; --------------------------------------- </span>
<span class="co">#&gt; The association is statistically significant at the 0.1 level. (p-value = 0.0660049)</span>
<span class="co">#&gt; On average, observations in the treated group are -1664.671 units below the control group for the outcome (re78).</span></code></pre></div>
<p>We use a paired t-test to test for a significant association between real earnings in 1978, ‘re78’, and whether the person belonged to the treatment group or control group. From the results above, we see that the association was significant at the 0.05 level (in fact, p &lt; 0.01). A person that received treatment, on average, made $2053.79 lesser in real earnings than a person that hadn’t in the year 1978.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Preksha Sreewastav, Grant Westfahl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
